
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}
//usuarios do sistema (familiares, admin, idosos)
model User {
  id String @id @map("_id") @default(auto()) @db.ObjectId

  email String @unique
  password String
  name String
  role String // "FAMILIAR" | "ADMIN" | "IDOSO"
  status String @default("PENDING") 
  planPaid  Boolean  @default(false)
  createdAt DateTime @default(now())
  elders Elder[]@relation("ChiefElders")
  // quando este user é o colaborador
  collaborations Collaborator[] @relation("CollaboratorUser")

  // quando este user é o chief de colaboradores
  collaborators Collaborator[] @relation("CollaboratorChief")
}

model Collaborator {
  id String @id @map("_id") @default(auto()) @db.ObjectId

  userId String @db.ObjectId
  user   User   @relation("CollaboratorUser", fields: [userId], references: [id])

  elderId String @db.ObjectId
  elder   Elder  @relation(fields: [elderId], references: [id])

  chiefId String @db.ObjectId
  chief   User   @relation("CollaboratorChief", fields: [chiefId], references: [id])

  createdAt DateTime @default(now())
}



//idosos cadastrados no sistema
model Elder {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  cpf String @unique
  name String
  chiefId String @db.ObjectId
  chief User @relation("ChiefElders", fields: [chiefId], references: [id])
  age Int
  birthData DateTime? 
  emergencyContact String
  medicalConditions String[]
  medications String[]
  collaborators Collaborator[]

  createdAt DateTime @default(now())

  reminders Reminder[]
}

// lembretes de alimentacao, medicacao, atividades
model Reminder {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  time        String  
  type        String   // Medicamento, Refeição, Rotina, Evento
  daysOfWeek  Int[]    // [1, 2, 3, 4, 5, 6, 7] onde 1 é Segunda e 7 é Domingo
  isCompleted Boolean  @default(false)
  lastDone    DateTime? // Para controlar a reciclagem diária
  
  elderId     String   @db.ObjectId
  elder       Elder    @relation(fields: [elderId], references: id)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([elderId])
}
model Emergency{
  id        String   @id @map("_id") @default(auto()) @db.ObjectId
  elderId   String   @db.ObjectId
  at        DateTime @default(now())
  location  String?  // opicional
  resolved  Boolean  @default(false)
}
//audios enviados pelos idosos para analise
model Audio {
  id        String   @id @map("_id") @default(auto()) @db.ObjectId
  elderId   String   @db.ObjectId
  url       String
  duration  Int      // seconds
  transcript String?
  status    String   // "PENDING" | "APPROVED" | "REJECTED"
  createdAt DateTime @default(now())
}

model VerificationCode {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  email String
  code String
  expiresAt DateTime
  used Boolean @default(false)
  createdAt DateTime @default(now())
}

model OTPResendLog {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  email String
  ip String
  sentAt DateTime @default(now())

  @@index([email])
  @@index([ip])
}

model Payment {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  userId String @db.ObjectId
  type String
  amount Int
  stripeSessionId  String   @unique
  status String @default("PENDING")
  createdAt DateTime @default(now())
}

